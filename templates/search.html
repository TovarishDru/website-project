{% extends "main.html" %}

{% block content %}
<h1>Добро пожаловать!</h1>
<header class='menu'>
    <ul class='menu_list'>
        <li class='menu_link'>
            <a href=''>Жанры</a>
            <ul class="sub_menu_list">
                {% for i in genres %}
                    <li class='sub_menu_link'>
                        <a href='/search/{{ i.name }}'>{{i.name}}</a>
                    </li>
                {% endfor %}
            </ul>
        </li>
        <li>
            <form action="" method="post">
                {{ form.hidden_tag() }}
                <p>
                    {{ form.title.label }}<br>
                    {{ form.title(class="form-control") }}<br>
                    {% for error in form.title.errors %}
                        <div class="alert alert-danger" role="alert">
                            {{ error }}
                        </div>
                {% endfor %}
                </p>
                <p>
                {{ form.submit(type="submit", class="btn btn-primary")}}
                </p>
            </form>
        </li>
    </ul>
</header>
<nav>
    {% if current_user.is_authenticated %}
        <a class="navbar-brand" href="/logout">{{ current_user.name }}</a>
    {% else %}
        <p>
            <a class="btn btn-primary " href="/register">Зарегистрироваться</a>
            <a class="btn btn-success" href="/login">Войти</a>
        </p>
    {% endif %}
</nav>
<h1>Игры</h1>
{% if not empty %}
    {% for item in games%}
    <div class="col-md6 border rounded">
        <h2>{{item.title}}</h2>
        <div>
            {{item.description}}
        </div>
        <img src="/static/img/{{item.picture}}" width="300px" height="200px">
        <div>
            Разработчик: - {{item.developer}}, Издатель - {{item.publisher}}, Дата выхода - {{item.date}}
        </div>
        <div>
            Цена - {{item.price}}руб.
        </div>
        <div>
            Категории:
            {% for i in item.categories %}
                {{i.name}}
            {% endfor %} 
        </div>
        <div>        
            {% if item.quantity > 0 %} 
                Осталось {{item.quantity}} ключей
            {% else %}
                Нет в наличии
            {% endif %}
        </div>
        {% if current_user.is_authenticated and current_user.role == 'admin' %}
        <div>
            <a href="/games_edit/{{ item.id }}" class="btn btn-warning">
                Изменить
            </a>
            <a href="/games_delete/{{ item.id }}" class="btn btn-danger">
                Удалить
            </a>
        </div>
        {% elif current_user.is_authenticated and current_user.role == 'user' %}
        <div>
            <a href="/games_info/{{ item.id }}" class="btn btn-warning">
                Подробнее
            </a>
        </div>
        {% endif %}
    </div>
    {% endfor %}
{% else %}
    Пока нет игр
{% endif %}
{% if current_user.is_authenticated and current_user.role == 'admin' %}
    <a href="/games" class="btn btn-secondary">Добавить игру</a>
{% elif current_user.is_authenticated and current_user.role == 'user' %}
    <a href="/cart" class="btn btn-secondary">Корзина</a>
{% endif %}
{% endblock %}